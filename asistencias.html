<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistencias - EDEC Apodaca</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        body { visibility: hidden; }
    </style>
</head>
<body class="buscador-page">
    <script>
        // Verificaci√≥n inmediata antes de renderizar contenido
        (function() {
            const isLoggedIn = localStorage.getItem('isLoggedInBuscador');
            if (isLoggedIn !== 'true') {
                window.location.replace('asistenciaslogin.html');
                return;
            }
            document.body.style.visibility = 'visible';
        })();
    </script>
    <div class="buscador-container">
        <button class="btn-cerrar-sesion" id="btnCerrarSesion">Cerrar Sesi√≥n</button>
        <h1>Asistencia Apodaca</h1>
        
        <div class="buscador-header">
            <button class="btn-filtros" id="btnFiltros">üîç Filtros</button>
            <input 
                type="text" 
                id="inputBuscarMatricula" 
                class="input-buscar" 
                placeholder="Buscar por matr√≠cula..."
            >
            <button class="btn-buscar" id="btnBuscar">Buscar</button>
            <button class="btn-fichados" id="btnFichados">Fichados</button>
            <button class="btn-excel" id="btnExcel">Importar a Excel</button>
        </div>

        <!-- Overlay para la ventana flotante -->
        <div class="filtros-overlay" id="filtrosOverlay" style="display: none;"></div>
        
        <!-- Modal para exportar a Excel -->
        <div class="modal-overlay" id="modalExcelOverlay" style="display: none;">
            <div class="modal-content" id="modalExcel">
                <button class="btn-cerrar-modal" id="btnCerrarModalExcel">√ó</button>
                <h2>Importar a Excel</h2>
                <div class="input-group">
                    <label for="excelFiltroDia">D√≠a:</label>
                    <select id="excelFiltroDia" class="input-filtro">
                        <option value="todos">Todos</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">21</option>
                        <option value="22">22</option>
                        <option value="23">23</option>
                        <option value="24">24</option>
                        <option value="25">25</option>
                        <option value="26">26</option>
                        <option value="27">27</option>
                        <option value="28">28</option>
                        <option value="29">29</option>
                        <option value="30">30</option>
                        <option value="31">31</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="excelFiltroMes">Mes:</label>
                    <select id="excelFiltroMes" class="input-filtro">
                        <option value="todos">Todos</option>
                        <option value="1">1 (Enero)</option>
                        <option value="2">2 (Febrero)</option>
                        <option value="3">3 (Marzo)</option>
                        <option value="4">4 (Abril)</option>
                        <option value="5">5 (Mayo)</option>
                        <option value="6">6 (Junio)</option>
                        <option value="7">7 (Julio)</option>
                        <option value="8">8 (Agosto)</option>
                        <option value="9">9 (Septiembre)</option>
                        <option value="10">10 (Octubre)</option>
                        <option value="11">11 (Noviembre)</option>
                        <option value="12">12 (Diciembre)</option>
                    </select>
                </div>
                <div class="modal-buttons">
                    <button class="btn-modal-cancel" id="btnCancelarExcel">Cancelar</button>
                    <button class="btn-modal-submit" id="btnGenerarExcel">Generar Excel</button>
                </div>
            </div>
        </div>
        
        <!-- Ventana flotante de filtros -->
        <div class="panel-filtros" id="panelFiltros" style="display: none;">
            <button class="btn-cerrar-filtros" id="btnCerrarFiltros">√ó</button>
            <h3>Filtros de B√∫squeda</h3>
            <div class="filtro-grupo">
                <label for="filtroDia">Filtrar por d√≠a (1-31):</label>
                <input 
                    type="number" 
                    id="filtroDia" 
                    class="input-filtro"
                    min="1"
                    max="31"
                    placeholder="D√≠a"
                >
                <button class="btn-limpiar-filtro" id="btnLimpiarDia">Limpiar</button>
            </div>
            <div class="filtro-grupo">
                <label for="filtroMes">Filtrar por mes (1-12):</label>
                <input 
                    type="number" 
                    id="filtroMes" 
                    class="input-filtro"
                    min="1"
                    max="12"
                    placeholder="Mes"
                >
                <button class="btn-limpiar-filtro" id="btnLimpiarMes">Limpiar</button>
            </div>
        </div>

        <div class="tabla-container">
            <table class="tabla-asistencias" id="tablaAsistencias">
                <thead>
                    <tr>
                        <th>Matr√≠cula</th>
                        <th>Nombre</th>
                        <th>Fecha</th>
                        <th>Hora</th>
                    </tr>
                </thead>
                <tbody id="tbodyAsistencias">
                    <!-- Las filas se agregar√°n din√°micamente -->
                </tbody>
            </table>
        </div>

        <div id="mensajeSinResultados" class="mensaje-sin-resultados" style="display: none;">
            No se encontraron resultados.
        </div>

        <!-- Contenedor de fichados (oculto por defecto) -->
        <div id="contenedorFichados" style="display: none;">
            <div class="fichados-header">
                <button class="btn-regresar" id="btnRegresar">‚Üê Regresar</button>
                <h2>Alumnos Fichados</h2>
            </div>
            <div class="tabla-container">
                <table class="tabla-fichados" id="tablaFichados">
                    <thead>
                        <tr>
                            <th>Matr√≠cula</th>
                            <th>Nombre</th>
                            <th>Programa</th>
                            <th>Fichas</th>
                        </tr>
                    </thead>
                    <tbody id="tbodyFichados">
                        <tr>
                            <td colspan="4" style="text-align: center;">Cargando fichados...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="js/authGuard_asistencias.js"></script>
    <script src="js/asistencias_buscador.js"></script>
</body>
</html>
