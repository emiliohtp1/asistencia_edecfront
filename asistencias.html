<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistencias - EDEC Apodaca</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        body { visibility: hidden; }
    </style>
</head>
<body class="buscador-page">
    <script>
        // Verificaci√≥n inmediata antes de renderizar contenido
        (function() {
            const isLoggedIn = localStorage.getItem('isLoggedInBuscador');
            if (isLoggedIn !== 'true') {
                window.location.replace('asistenciaslogin.html');
                return;
            }
            document.body.style.visibility = 'visible';
        })();
    </script>
    <div class="buscador-container">
        <button class="btn-cerrar-sesion" id="btnCerrarSesion">Cerrar Sesi√≥n</button>
        <h1>Asistencia Apodaca</h1>
        
        <div class="buscador-header">
            <button class="btn-filtros" id="btnFiltros">üîç Filtros</button>
            <input 
                type="text" 
                id="inputBuscarMatricula" 
                class="input-buscar" 
                placeholder="Buscar por matr√≠cula..."
            >
            <button class="btn-buscar" id="btnBuscar">Buscar</button>
            <button class="btn-fichados" id="btnFichados">Fichados</button>
            <button class="btn-excel" id="btnExcel">Importar a Excel</button>
        </div>

        <!-- Overlay para la ventana flotante -->
        <div class="filtros-overlay" id="filtrosOverlay" style="display: none;"></div>
        
        <!-- Modal para exportar a Excel -->
        <div class="modal-overlay" id="modalExcelOverlay" style="display: none;">
            <div class="modal-content" id="modalExcel">
                <button class="btn-cerrar-modal" id="btnCerrarModalExcel">√ó</button>
                <h2>Importar a Excel</h2>
                <div id="mensajeExitoExcel" class="mensaje-exito-excel" style="display: none;">
                    Archivo generado exitosamente
                </div>
                <div class="input-group">
                    <label>Seleccionar fecha (opcional):</label>
                    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                        <select 
                            id="excelFiltroDia" 
                            class="input-filtro"
                            style="min-width: 80px;"
                        >
                            <option value="">D√≠a</option>
                        </select>
                        <select 
                            id="excelFiltroMes" 
                            class="input-filtro"
                            style="min-width: 100px;"
                        >
                            <option value="">Mes</option>
                        </select>
                        <select 
                            id="excelFiltroAnio" 
                            class="input-filtro"
                            style="min-width: 100px;"
                        >
                            <option value="">A√±o</option>
                        </select>
                        <button 
                            type="button" 
                            id="btnLimpiarFechaExcel" 
                            class="btn-limpiar-filtro"
                            style="white-space: nowrap;"
                        >
                            Limpiar / Todos
                        </button>
                    </div>
                    <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">
                        Selecciona d√≠a, mes y/o a√±o para filtrar. Deja alguno vac√≠o para incluir todos los valores de ese campo. Si todos est√°n vac√≠os, se exportar√°n todas las asistencias.
                    </small>
                </div>
                <div class="modal-buttons">
                    <button class="btn-modal-cancel" id="btnCancelarExcel">Cancelar</button>
                    <button class="btn-modal-submit" id="btnGenerarExcel">Generar Excel</button>
                </div>
            </div>
        </div>
        
        <!-- Ventana flotante de filtros -->
        <div class="panel-filtros" id="panelFiltros" style="display: none;">
            <button class="btn-cerrar-filtros" id="btnCerrarFiltros">√ó</button>
            <h3>Filtros de B√∫squeda</h3>
            <div class="filtro-grupo">
                <label for="filtroDia">Filtrar por d√≠a (1-31):</label>
                <input 
                    type="number" 
                    id="filtroDia" 
                    class="input-filtro"
                    min="1"
                    max="31"
                    placeholder="D√≠a"
                >
                <button class="btn-limpiar-filtro" id="btnLimpiarDia">Limpiar</button>
            </div>
            <div class="filtro-grupo">
                <label for="filtroMes">Filtrar por mes (1-12):</label>
                <input 
                    type="number" 
                    id="filtroMes" 
                    class="input-filtro"
                    min="1"
                    max="12"
                    placeholder="Mes"
                >
                <button class="btn-limpiar-filtro" id="btnLimpiarMes">Limpiar</button>
            </div>
        </div>

        <div class="tabla-container">
            <table class="tabla-asistencias" id="tablaAsistencias">
                <thead>
                    <tr>
                        <th>Matr√≠cula</th>
                        <th>Nombre</th>
                        <th>Fecha</th>
                        <th>Hora</th>
                    </tr>
                </thead>
                <tbody id="tbodyAsistencias">
                    <!-- Las filas se agregar√°n din√°micamente -->
                </tbody>
            </table>
        </div>

        <div class="paginacion-asistencias" id="paginacionAsistencias">
            <!-- Los botones de paginaci√≥n se generar√°n din√°micamente -->
        </div>

        <div id="mensajeSinResultados" class="mensaje-sin-resultados" style="display: none;">
            No se encontraron resultados.
        </div>

        <!-- Contenedor de fichados (oculto por defecto) -->
        <div id="contenedorFichados" style="display: none;">
            <div class="fichados-header">
                <button class="btn-regresar" id="btnRegresar">‚Üê Regresar</button>
                <h2>Alumnos Fichados</h2>
                <div id="mensajeExitoFichados" class="mensaje-exito-fichados" style="display: none;">
                    Archivo generado exitosamente
                </div>
                <button class="btn-excel-fichados" id="btnExcelFichados">Importar a Excel</button>
            </div>
            <div class="tabla-container">
                <table class="tabla-fichados" id="tablaFichados">
                    <thead>
                        <tr>
                            <th>Matr√≠cula</th>
                            <th>Nombre</th>
                            <th>Programa</th>
                            <th>Fichas</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tbodyFichados">
                        <tr>
                            <td colspan="5" style="text-align: center;">Cargando fichados...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="paginacion-fichados" id="paginacionFichados">
                <!-- Los botones de paginaci√≥n se generar√°n din√°micamente -->
            </div>
        </div>
    </div>

    <!-- Modal para confirmar eliminaci√≥n de registro de fichado -->
    <div class="modal-overlay" id="modalEliminarFichado" style="display: none;">
        <div class="modal-content modal-fichar">
            <h2 id="tituloEliminarFichado">¬øEliminar 1 registro del usuario?</h2>
            <div id="mensajeExitoEliminarFichado" class="mensaje-exito" style="display: none;">
                1 registro eliminado correctamente
            </div>
            <div class="modal-buttons-fichar" id="botonesEliminarFichado">
                <button class="btn-fichar-si" id="btnEliminarFichadoSi">S√≠</button>
                <button class="btn-fichar-no" id="btnEliminarFichadoNo">No</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/exceljs@4.4.0/dist/exceljs.min.js"></script>
    <script src="js/authGuard_asistencias.js"></script>
    <script src="js/asistencias_buscador.js"></script>
</body>
</html>
