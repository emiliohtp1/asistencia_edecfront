<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Administrador - EDEC</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        body { visibility: hidden; }
    </style>
</head>
<body class="administrador-page">
    <script>
        // Verificaci√≥n inmediata antes de renderizar contenido
        (function() {
            const isLoggedIn = localStorage.getItem('isLoggedInAdmin');
            const correoUsuario = localStorage.getItem('adminCorreo');
            
            if (isLoggedIn !== 'true' || !correoUsuario) {
                window.location.replace('administradorlogin.html');
                return;
            }
            
            // Verificaci√≥n r√°pida del rol (la verificaci√≥n completa se hace en authGuard)
            const rolGuardado = localStorage.getItem('adminRol');
            const rolesPermitidos = ['administrador', 'director', 'coordinador'];
            if (!rolesPermitidos.includes(rolGuardado)) {
                localStorage.removeItem('isLoggedInAdmin');
                localStorage.removeItem('adminCorreo');
                localStorage.removeItem('adminRol');
                localStorage.removeItem('adminContrase√±a');
                window.location.replace('administradorlogin.html');
                return;
            }
            
            document.body.style.visibility = 'visible';
        })();
    </script>
    <!-- Botones superiores derechos -->
    <div class="admin-header-buttons">
        <button class="btn-usuario-circular" id="btnUsuarioCircular">U</button>
        <button class="btn-cerrar-sesion-admin" id="btnCerrarSesion">Cerrar Sesi√≥n</button>
    </div>

    <div class="administrador-container" id="containerPrincipal">
        <h1>Dashboard Administrador</h1>
        
        <div class="dashboard-buttons">
            <button class="btn-dashboard" id="btnBuscador" data-url="buscador.html">
                <span class="btn-icon">üîç</span>
                <span class="btn-text">Buscador de Alumnos</span>
            </button>
            <button class="btn-dashboard" id="btnAsistencias" data-url="asistencias.html">
                <span class="btn-icon">üìã</span>
                <span class="btn-text">Asistencias</span>
            </button>
            <button class="btn-dashboard" id="btnRegistrador" data-url="home.html">
                <span class="btn-icon">üìù</span>
                <span class="btn-text">Registrador de Asistencia</span>
            </button>
            <button class="btn-dashboard" id="btnRegistradorBarras" data-url="registradorbarras.html">
                <span class="btn-icon">üìä</span>
                <span class="btn-text">Registrador de Barras</span>
            </button>
            <button class="btn-dashboard" id="btnUsuarios">
                <span class="btn-icon">üë•</span>
                <span class="btn-text">Usuarios</span>
            </button>
            <button class="btn-dashboard" id="btnAlumnos">
                <span class="btn-icon">üéì</span>
                <span class="btn-text">Alumnos</span>
            </button>
            <button class="btn-dashboard" id="btnVinculacion" data-url="vinculacion.html">
                <span class="btn-icon">üîó</span>
                <span class="btn-text">Registros Vinculaci√≥n</span>
            </button>
        </div>
    </div>

    <!-- Container para la vista de alumnos -->
    <div class="administrador-container" id="containerAlumnos" style="display: none;">
        <h1>Lista de Alumnos</h1>
        
        <div class="alumnos-controls">
            <button class="btn-regresar-alumnos" id="btnRegresarAlumnos">‚Üê Regresar</button>
            <div class="alumnos-controls-right">
                <div class="selector-tipo-alumno">
                    <label for="selectTipoAlumno">Tipo de Alumno:</label>
                    <select id="selectTipoAlumno" name="selectTipoAlumno">
                        <option value="bachillerato">Bachillerato</option>
                        <option value="universidad">Universidad</option>
                    </select>
                </div>
                <button class="btn-agregar-alumno" id="btnAgregarAlumno">Agregar Alumno</button>
            </div>
        </div>
        
        <div class="buscador-alumnos-container">
            <input type="text" id="inputBuscarAlumno" class="input-buscar-alumno" placeholder="Buscar alumno bachillerato">
        </div>

        <div class="tabla-alumnos-container">
            <table class="tabla-alumnos" id="tablaAlumnos">
                <thead>
                    <tr>
                        <th>Matr√≠cula</th>
                        <th>Alumno</th>
                        <th>Programa</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="tbodyAlumnos">
                    <tr>
                        <td colspan="4" style="text-align: center;">Cargando alumnos...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="paginacion-alumnos" id="paginacionAlumnos">
            <!-- Los botones de paginaci√≥n se generar√°n din√°micamente -->
        </div>
    </div>

    <!-- Modal para confirmar eliminaci√≥n de alumno -->
    <div class="modal-overlay" id="modalEliminarAlumno" style="display: none;">
        <div class="modal-content modal-confirmacion">
            <h2>¬øEliminar Alumno?</h2>
            <p id="success-message-eliminar" class="success-message-eliminar" style="display: none;"></p>
            <div class="modal-buttons modal-buttons-centered">
                <button type="button" class="btn-modal-submit" id="btnConfirmarEliminar">S√≠</button>
                <button type="button" class="btn-modal-cancel" id="btnCancelarEliminar">No</button>
            </div>
        </div>
    </div>

    <!-- Modal para crear alumno -->
    <div class="modal-overlay" id="modalCrearAlumno" style="display: none;">
        <div class="modal-content modal-crear-alumno">
            <button class="btn-cerrar-modal" id="btnCerrarCrearAlumno">√ó</button>
            <h2>Crear Nuevo Alumno</h2>
            <form id="formCrearAlumno">
                <div class="form-columns">
                    <div class="form-column">
                        <div class="input-group">
                            <label for="cursoCrear">Curso:</label>
                            <select id="cursoCrear" name="cursoCrear" required>
                                <option value="">Seleccione un curso</option>
                                <option value="Bachillerato">Bachillerato</option>
                                <option value="Universidad">Universidad</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="matriculaCrear">Matr√≠cula:</label>
                            <input type="text" id="matriculaCrear" name="matriculaCrear" required>
                        </div>
                        <div class="input-group">
                            <label for="nombreCrear">Nombre:</label>
                            <input type="text" id="nombreCrear" name="nombreCrear" required>
                        </div>
                        <div class="input-group">
                            <label for="coordinadorCrear">Coordinador:</label>
                            <input type="text" id="coordinadorCrear" name="coordinadorCrear" required>
                        </div>
                        <div class="input-group">
                            <label for="graduadoCrear">Graduado:</label>
                            <select id="graduadoCrear" name="graduadoCrear" required>
                                <option value="No" selected>No</option>
                                <option value="Si">S√≠</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-column">
                        <div class="input-group">
                            <label for="correoCrearAlumno">Correo:</label>
                            <input type="email" id="correoCrearAlumno" name="correoCrearAlumno" required>
                        </div>
                        <div class="input-group">
                            <label for="campusCrearAlumno">Campus:</label>
                            <input type="text" id="campusCrearAlumno" name="campusCrearAlumno" value="Apodaca" required>
                        </div>
                        <div class="input-group">
                            <label for="programaCrear">Programa:</label>
                            <input type="text" id="programaCrear" name="programaCrear" required>
                        </div>
                        <div class="input-group">
                            <label for="cicloCrear">Ciclo:</label>
                            <input type="text" id="cicloCrear" name="cicloCrear" required>
                        </div>
                        <div class="input-group">
                            <label for="turnoCrear">Turno:</label>
                            <select id="turnoCrear" name="turnoCrear" required>
                                <option value="Matutino" selected>Matutino</option>
                                <option value="Vespertino">Vespertino</option>
                                <option value="Nocturno">Nocturno</option>
                            </select>
                        </div>
                    </div>
                </div>
                <p id="error-message-crear-alumno" class="error-text" style="display: none;"></p>
                <p id="success-message-crear-alumno" class="success-message-crear-alumno" style="display: none;"></p>
                <div class="modal-buttons">
                    <button type="submit" class="btn-modal-submit">Crear Alumno</button>
                    <button type="button" class="btn-modal-cancel" id="btnCancelarCrearAlumno">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para crear usuario -->
    <div class="modal-overlay" id="modalCrearUsuario" style="display: none;">
        <div class="modal-content">
            <button class="btn-cerrar-modal" id="btnCerrarCrearUsuario">√ó</button>
            <h2>Crear Nuevo Usuario</h2>
            <form id="formCrearUsuario">
                <div class="input-group">
                    <label for="nombreCompleto">Nombre Completo:</label>
                    <input type="text" id="nombreCompleto" name="nombreCompleto" required>
                </div>
                <div class="input-group">
                    <label for="correoCrear">Correo:</label>
                    <input type="email" id="correoCrear" name="correoCrear" required>
                </div>
                <div class="input-group">
                    <label for="contrase√±aCrear">Contrase√±a:</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="contrase√±aCrear" name="contrase√±aCrear" required>
                    </div>
                </div>
                <div class="input-group">
                    <label for="rolCrear">Rol:</label>
                    <select id="rolCrear" name="rolCrear" required>
                        <option value="">Seleccione un rol</option>
                        <option value="administrador">Administrador</option>
                        <option value="director">Director</option>
                        <option value="coordinador">Coordinador</option>
                        <option value="maestro">Maestro</option>
                        <option value="alumno">Alumno</option>
                        <option value="servicio social">Servicio Social</option>
                        <option value="vinculacion">Vinculaci√≥n</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="campusCrear">Campus:</label>
                    <select id="campusCrear" name="campusCrear" required>
                        <option value="">Seleccione un campus</option>
                        <option value="apodaca">Apodaca</option>
                        <option value="miguel aleman">Miguel Alem√°n</option>
                        <option value="eloy cavazos">Eloy Cavazos</option>
                    </select>
                </div>
                <p id="error-message-crear" class="error-text" style="display: none;"></p>
                <p id="success-message-crear" class="success-text" style="display: none;"></p>
                <div class="modal-buttons">
                    <button type="submit" class="btn-modal-submit">Crear Usuario</button>
                    <button type="button" class="btn-modal-cancel" id="btnCancelarCrearUsuario">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para informaci√≥n del usuario -->
    <div class="modal-overlay" id="modalInfoUsuario" style="display: none;">
        <div class="modal-content">
            <button class="btn-cerrar-modal" id="btnCerrarInfoUsuario">√ó</button>
            <h2>Informaci√≥n del Usuario</h2>
            <div id="infoUsuarioContent">
                <p>Cargando informaci√≥n...</p>
            </div>
            <div class="modal-buttons">
                <button type="button" class="btn-modal-submit" id="btnCambiarContrase√±a">Cambiar Contrase√±a</button>
                <button type="button" class="btn-modal-cancel" id="btnCerrarInfoUsuario2">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal para cambiar contrase√±a -->
    <div class="modal-overlay" id="modalCambiarContrase√±a" style="display: none;">
        <div class="modal-content">
            <button class="btn-cerrar-modal" id="btnCerrarCambiarContrase√±a">√ó</button>
            <h2>Cambiar Contrase√±a</h2>
            <form id="formCambiarContrase√±a">
                <div class="input-group">
                    <label for="contrase√±aActual">Contrase√±a Actual:</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="contrase√±aActual" name="contrase√±aActual" required>
                    </div>
                </div>
                <div class="input-group">
                    <label for="nuevaContrase√±a">Nueva Contrase√±a:</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="nuevaContrase√±a" name="nuevaContrase√±a" required>
                    </div>
                </div>
                <div class="input-group">
                    <label for="confirmarContrase√±a">Confirmar Nueva Contrase√±a:</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="confirmarContrase√±a" name="confirmarContrase√±a" required>
                    </div>
                </div>
                <p id="error-message-password" class="error-text" style="display: none;"></p>
                <p id="success-message-password" class="success-text" style="display: none;"></p>
                <div class="modal-buttons">
                    <button type="submit" class="btn-modal-submit">Cambiar Contrase√±a</button>
                    <button type="button" class="btn-modal-cancel" id="btnCancelarCambiarContrase√±a">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para gestionar usuarios -->
    <div class="modal-overlay" id="modalUsuarios" style="display: none;">
        <div class="modal-content modal-usuarios">
            <button class="btn-cerrar-modal" id="btnCerrarUsuarios">√ó</button>
            <h2>Gesti√≥n de Usuarios</h2>
            <div class="usuarios-header">
                <button class="btn-pendientes-aprobacion" id="btnPendientesAprobacion">
                    Usuarios Pendientes
                    <span class="badge-pendientes" id="badgePendientes">0</span>
                </button>
                <button class="btn-crear-usuario-modal" id="btnCrearUsuarioModal">Crear Usuario</button>
            </div>
            <div class="tabla-usuarios-container">
                <table class="tabla-usuarios" id="tablaUsuarios">
                    <thead>
                        <tr>
                            <th data-columna="nombre" class="sortable-header">Nombre Completo</th>
                            <th data-columna="correo" class="sortable-header">Correo</th>
                            <th data-columna="rol" class="sortable-header">Rol</th>
                            <th data-columna="campus" class="sortable-header">Campus</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tbodyUsuarios">
                        <tr>
                            <td colspan="5" style="text-align: center;">Cargando usuarios...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal para usuarios pendientes de aprobaci√≥n -->
    <div class="modal-overlay" id="modalUsuariosPendientes" style="display: none;">
        <div class="modal-content modal-usuarios">
            <button class="btn-cerrar-modal" id="btnCerrarUsuariosPendientes">√ó</button>
            <h2>Usuarios Pendientes de Aprobaci√≥n</h2>
            <div class="usuarios-header">
                <button class="btn-actualizar-lista" id="btnActualizarListaPendientes">Actualizar lista</button>
            </div>
            <div class="tabla-usuarios-container">
                <table class="tabla-usuarios" id="tablaUsuariosPendientes">
                    <thead>
                        <tr>
                            <th>Nombre Completo</th>
                            <th>Correo</th>
                            <th>Rol</th>
                            <th>Campus</th>
                            <th>Fecha de Creaci√≥n</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tbodyUsuariosPendientes">
                        <tr>
                            <td colspan="6" style="text-align: center;">Cargando usuarios pendientes...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="js/password-toggle.js"></script>
    <script src="js/authGuard_administrador.js"></script>
    <script src="js/administrador.js"></script>
</body>
</html>
